# ðŸ› ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ - Ù…Ø§Ú˜ÙˆÙ„ Ù†Ø¬Ù… Ø¨Ù‡Ø§Ø±

## ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

1. [Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„](#Ù…Ø¹Ù…Ø§Ø±ÛŒ-Ù…Ø§Ú˜ÙˆÙ„)
2. [Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§](#Ø³Ø§Ø®ØªØ§Ø±-ÙØ§ÛŒÙ„â€ŒÙ‡Ø§)
3. [Ù…Ø¯Ù„â€ŒÙ‡Ø§](#Ù…Ø¯Ù„â€ŒÙ‡Ø§)
4. [Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§](#Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§)
5. [ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Legacy](#ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ-Ø¨Ø§-legacy)
6. [ØªÙˆØ³Ø¹Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯](#ØªÙˆØ³Ø¹Ù‡-ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ-Ø¬Ø¯ÛŒØ¯)
7. [ØªØ³Øªâ€ŒÙ‡Ø§](#ØªØ³Øªâ€ŒÙ‡Ø§)
8. [Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Performance](#Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ-Ùˆ-performance)

---

## Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„

Ù…Ø§Ú˜ÙˆÙ„ Ù†Ø¬Ù… Ø¨Ù‡Ø§Ø± ÛŒÚ© Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ù†Ú©ÛŒ Ø³Ø§Ø¯Ù‡ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³Øª:

- **Double-Entry Accounting**: ØªÙ…Ø§Ù… ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯ÙØªØ± Ú©Ù„ Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- **Atomic Transactions**: ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§Ù„ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª atomic Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- **Idempotency**: Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² idempotency key Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ
- **Scheduled Transactions**: Ø§Ù…Ú©Ø§Ù† Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
- **Legacy Integration**: ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø³ÛŒØ³ØªÙ… Ù‚Ø¯ÛŒÙ…ÛŒ Spring

---

## Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§

```
app/Modules/NajmBahar/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ Account.php              # Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
â”‚   â”œâ”€â”€ SubAccount.php           # Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ ÙØ±Ø¹ÛŒ
â”‚   â”œâ”€â”€ Transaction.php          # ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
â”‚   â”œâ”€â”€ ScheduledTransaction.php # ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡
â”‚   â””â”€â”€ LedgerEntry.php          # Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø¯ÙØªØ± Ú©Ù„
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ AccountNumberService.php # ØªÙˆÙ„ÛŒØ¯ Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨
â”‚   â”œâ”€â”€ AccountService.php       # Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§
â”‚   â””â”€â”€ TransactionService.php  # Ù…Ø¯ÛŒØ±ÛŒØª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
â”œâ”€â”€ Adapters/
â”‚   â””â”€â”€ LegacyNajmAdapter.php    # Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ù‚Ø¯ÛŒÙ…ÛŒ
â”œâ”€â”€ README.md                    # Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ
â”œâ”€â”€ API_DOCUMENTATION.md         # Ù…Ø³ØªÙ†Ø¯Ø§Øª API
â””â”€â”€ DEVELOPER_GUIDE.md           # Ø§ÛŒÙ† ÙØ§ÛŒÙ„
```

---

## Ù…Ø¯Ù„â€ŒÙ‡Ø§

### Account

Ø­Ø³Ø§Ø¨ Ø§ØµÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ø³ÛŒØ³ØªÙ….

**Ø¬Ø¯ÙˆÙ„:** `najm_accounts`

**ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ù‡Ù…:**
- `account_number`: Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨ (10 Ø±Ù‚Ù…ØŒ unique)
- `user_id`: Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± (nullable Ø¨Ø±Ø§ÛŒ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…)
- `type`: Ù†ÙˆØ¹ Ø­Ø³Ø§Ø¨ (`system`, `user`, `legal_entity`, `bank`)
- `balance`: Ù…ÙˆØ¬ÙˆØ¯ÛŒ (integerØŒ Ø¨Ù‡ Ú©ÙˆÚ†Ú©â€ŒØªØ±ÛŒÙ† ÙˆØ§Ø­Ø¯)

**Ù…Ø«Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡:**
```php
use App\Modules\NajmBahar\Models\Account;

// Ø§ÛŒØ¬Ø§Ø¯ Ø­Ø³Ø§Ø¨
$account = Account::create([
    'account_number' => '1000000123',
    'user_id' => 123,
    'name' => 'NajmBahar Account',
    'type' => 'user',
    'balance' => 0,
]);

// Ø¯Ø±ÛŒØ§ÙØª Ø­Ø³Ø§Ø¨
$account = Account::where('account_number', '1000000123')->first();
```

### Transaction

ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ.

**Ø¬Ø¯ÙˆÙ„:** `najm_transactions`

**ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ù‡Ù…:**
- `from_account_id`: Ø­Ø³Ø§Ø¨ Ù…Ø¨Ø¯Ø§ (nullable Ø¨Ø±Ø§ÛŒ ÙˆØ§Ø±ÛŒØ² Ø§Ø² Ø³ÛŒØ³ØªÙ…)
- `to_account_id`: Ø­Ø³Ø§Ø¨ Ù…Ù‚ØµØ¯
- `amount`: Ù…Ø¨Ù„Øº (integer)
- `type`: Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ (`immediate`, `scheduled`, `fee`, `adjustment`)
- `status`: ÙˆØ¶Ø¹ÛŒØª (`pending`, `completed`, `failed`)
- `metadata`: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒ (JSON)

**Ù…Ø«Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡:**
```php
use App\Modules\NajmBahar\Models\Transaction;

$transaction = Transaction::create([
    'from_account_id' => 1,
    'to_account_id' => 2,
    'amount' => 100,
    'type' => 'immediate',
    'status' => 'completed',
    'description' => 'Transfer',
    'metadata' => ['idempotency_key' => 'unique-key'],
]);
```

### LedgerEntry

Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø¯ÙØªØ± Ú©Ù„ (Double-Entry).

**Ø¬Ø¯ÙˆÙ„:** `najm_ledger_entries`

**ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ù‡Ù…:**
- `transaction_id`: Ø´Ù†Ø§Ø³Ù‡ ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø±ØªØ¨Ø·
- `account_id`: Ø´Ù†Ø§Ø³Ù‡ Ø­Ø³Ø§Ø¨
- `amount`: Ù…Ø¨Ù„Øº (Ù…Ø«Ø¨Øª Ø¨Ø±Ø§ÛŒ creditØŒ Ù…Ù†ÙÛŒ Ø¨Ø±Ø§ÛŒ debit)
- `entry_type`: Ù†ÙˆØ¹ Ø±Ø¯ÛŒÙ (`debit`, `credit`)

**Ù…Ø«Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡:**
```php
use App\Modules\NajmBahar\Models\LedgerEntry;

// Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¯ÛŒÙ debit
LedgerEntry::create([
    'transaction_id' => 1,
    'account_id' => 1,
    'amount' => -100,
    'entry_type' => 'debit',
]);

// Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¯ÛŒÙ credit
LedgerEntry::create([
    'transaction_id' => 1,
    'account_id' => 2,
    'amount' => 100,
    'entry_type' => 'credit',
]);
```

---

## Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§

### AccountNumberService

ØªÙˆÙ„ÛŒØ¯ Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§.

**Ù…ØªØ¯Ù‡Ø§:**
- `makeMainAccountNumberForUser(int $userId): string`
- `makeSystemAccountNumber(): string`
- `makeSubAccountCode(string $mainAccountNumber, int $subIndex): string`

**Ù…Ø«Ø§Ù„:**
```php
use App\Modules\NajmBahar\Services\AccountNumberService;

$userAccountNumber = AccountNumberService::makeMainAccountNumberForUser(123);
// Ù†ØªÛŒØ¬Ù‡: "1000000123"

$systemAccountNumber = AccountNumberService::makeSystemAccountNumber();
// Ù†ØªÛŒØ¬Ù‡: "0000000000"

$subAccountCode = AccountNumberService::makeSubAccountCode('0000000000', 1);
// Ù†ØªÛŒØ¬Ù‡: "0000000000-001"
```

### AccountService

Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§.

**Ù…ØªØ¯Ù‡Ø§:**
- `createMainAccountForUser(int $userId, string $name = 'NajmBahar Account'): Account`

**Ù…Ø«Ø§Ù„:**
```php
use App\Modules\NajmBahar\Services\AccountService;

$service = new AccountService();
$account = $service->createMainAccountForUser(123, 'My Account');
```

### TransactionService

Ù…Ø¯ÛŒØ±ÛŒØª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ (Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ† Ø³Ø±ÙˆÛŒØ³).

**Ù…ØªØ¯Ù‡Ø§:**
- `transfer(string|null $fromAccountNumber, string $toAccountNumber, int $amount, string $description = null, array $meta = [], string|null $idempotencyKey = null): Transaction`

**ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§:**
- Atomic operations (DB transaction)
- Double-entry ledger entries
- Idempotency support
- Account locking Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² race condition
- Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ

**Ù…Ø«Ø§Ù„:**
```php
use App\Modules\NajmBahar\Services\TransactionService;

$service = new TransactionService();

// Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø¯ÛŒÚ¯Ø±
$transaction = $service->transfer(
    '1000000123',  // from
    '1000000456',  // to
    100,           // amount
    'Payment',     // description
    [],            // metadata
    'unique-key'   // idempotency key
);

// ÙˆØ§Ø±ÛŒØ² Ø§Ø² Ø³ÛŒØ³ØªÙ…
$transaction = $service->transfer(
    null,          // from (system)
    '1000000123',  // to
    10000,         // amount
    'Initial funding'
);
```

**Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…Ù…Ú©Ù†:**
- `InvalidArgumentException`: Ù…Ø¨Ù„Øº Ù†Ø§Ù…Ø¹ØªØ¨Ø±
- `RuntimeException`: Ø­Ø³Ø§Ø¨ ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª

---

## ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Legacy

### LegacyNajmAdapter

Ø§ÛŒÙ† adapter Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ø³ÛŒØ³ØªÙ… Ù‚Ø¯ÛŒÙ…ÛŒ Spring Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

**Ù…ØªØ¯Ù‡Ø§:**
- `onSpringCreated(Spring $spring): void`

**Ù†Ø­ÙˆÙ‡ Ú©Ø§Ø±:**
1. Ù‡Ù†Ú¯Ø§Ù… Ø§ÛŒØ¬Ø§Ø¯ Spring Ø¬Ø¯ÛŒØ¯ØŒ Event Listener Ø¯Ø± `AppServiceProvider` ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
2. Job `ProcessSpringCreatedNajm` Ø¯Ø± ØµÙ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯
3. Adapter Ø­Ø³Ø§Ø¨ NajmBahar Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
4. ÙˆØ§Ø±ÛŒØ² Ø§ÙˆÙ„ÛŒÙ‡ 10000 Ø¨Ù‡Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯
5. Ú©Ø§Ø±Ù…Ø²Ø¯ Ø¹Ø¶ÙˆÛŒØª 12 Ø¨Ù‡Ø§Ø± Ú©Ø³Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯

**Ù…Ø«Ø§Ù„:**
```php
use App\Models\Spring;
use App\Modules\NajmBahar\Adapters\LegacyNajmAdapter;

$spring = new Spring([
    'user_id' => 123,
    'name' => 'Test',
    'amount' => 0,
    'status' => 0,
]);
$spring->save();

// Adapter Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
// ÛŒØ§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø³ØªÛŒ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ú©Ù†ÛŒØ¯:
LegacyNajmAdapter::onSpringCreated($spring);
```

---

## ØªÙˆØ³Ø¹Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

### Ø§ÙØ²ÙˆØ¯Ù† Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯

1. **Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ enum Ø¯Ø± Transaction:**
```php
// Ø¯Ø± TransactionService ÛŒØ§ middleware
$allowedTypes = ['immediate', 'scheduled', 'fee', 'adjustment', 'your_new_type'];
```

2. **Ø§ÙØ²ÙˆØ¯Ù† Ù…Ù†Ø·Ù‚ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±:**
```php
// Ø¯Ø± TransactionService
if ($type === 'your_new_type') {
    // Ù…Ù†Ø·Ù‚ Ø®Ø§Øµ
}
```

### Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ù…Ø²Ø¯

```php
use App\Modules\NajmBahar\Services\TransactionService;

$service = new TransactionService();

// Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§ Ú©Ø§Ø±Ù…Ø²Ø¯
$amount = 100;
$fee = 5; // 5 Ø¨Ù‡Ø§Ø± Ú©Ø§Ø±Ù…Ø²Ø¯

// Ú©Ø³Ø± Ú©Ø§Ø±Ù…Ø²Ø¯ Ø§Ø² Ø­Ø³Ø§Ø¨ Ù…Ø¨Ø¯Ø§
$service->transfer(
    $fromAccountNumber,
    $feeAccountNumber,
    $fee,
    'Transaction fee'
);

// Ø§Ù†ØªÙ‚Ø§Ù„ Ø§ØµÙ„ÛŒ
$service->transfer(
    $fromAccountNumber,
    $toAccountNumber,
    $amount,
    'Main transfer'
);
```

### Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§

```php
// Ø¯Ø± TransactionService::transfer()
if ($amount > $maxTransferLimit) {
    throw new \RuntimeException('Amount exceeds transfer limit');
}

if ($dailyTransferCount >= $maxDailyTransfers) {
    throw new \RuntimeException('Daily transfer limit reached');
}
```

---

## ØªØ³Øªâ€ŒÙ‡Ø§

### Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§

```bash
# ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ NajmBahar
php artisan test --filter NajmBahar

# ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Unit
php artisan test tests/Unit/AccountNumberServiceTest.php
php artisan test tests/Unit/AccountServiceTest.php

# ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Feature
php artisan test tests/Feature/TransactionServiceTest.php
php artisan test tests/Feature/LegacyNajmAdapterTest.php
php artisan test tests/Feature/NajmBaharApiTest.php
php artisan test tests/Feature/ScheduledTransactionTest.php
```

### Ù†ÙˆØ´ØªÙ† ØªØ³Øª Ø¬Ø¯ÛŒØ¯

**Ù…Ø«Ø§Ù„ ØªØ³Øª Unit:**
```php
namespace Tests\Unit;

use Tests\TestCase;
use App\Modules\NajmBahar\Services\YourService;

class YourServiceTest extends TestCase
{
    public function test_your_method()
    {
        $service = new YourService();
        $result = $service->yourMethod();
        
        $this->assertNotNull($result);
    }
}
```

**Ù…Ø«Ø§Ù„ ØªØ³Øª Feature:**
```php
namespace Tests\Feature;

use Tests\TestCase;
use Illuminate\Foundation\Testing\RefreshDatabase;

class YourFeatureTest extends TestCase
{
    use RefreshDatabase;

    public function test_your_endpoint()
    {
        $response = $this->getJson('/api/your-endpoint');
        
        $response->assertStatus(200);
    }
}
```

---

## Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Performance

### Indexes

ØªÙ…Ø§Ù… Ø¬Ø¯Ø§ÙˆÙ„ Ø¯Ø§Ø±Ø§ÛŒ indexâ€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ù‡Ø³ØªÙ†Ø¯:
- `account_number` (unique)
- `user_id`
- `from_account_id`, `to_account_id`
- `transaction_id`
- `execute_at` (Ø¨Ø±Ø§ÛŒ scheduled transactions)

### Query Optimization

**Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Eager Loading:**
```php
// Ø¨Ø¯
$transactions = Transaction::all();
foreach ($transactions as $tx) {
    $fromAccount = Account::find($tx->from_account_id);
}

// Ø®ÙˆØ¨
$transactions = Transaction::with('fromAccount', 'toAccount')->get();
```

**Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Pagination:**
```php
// Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯
$transactions = Transaction::paginate(25);
```

### Caching

Ø¨Ø±Ø§ÛŒ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø§Ø³ØªÙØ§Ø¯Ù‡:
```php
use Illuminate\Support\Facades\Cache;

$balance = Cache::remember("account_balance_{$accountNumber}", 60, function () use ($accountNumber) {
    return Account::where('account_number', $accountNumber)->value('balance');
});
```

### Database Transactions

Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø² DB transactions Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:
```php
use Illuminate\Support\Facades\DB;

DB::transaction(function () {
    // Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§Ù„ÛŒ
});
```

---

## Ù†Ú©Ø§Øª Ù…Ù‡Ù…

### 1. Thread Safety

Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² race conditionØŒ Ø§Ø² account locking Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯:
```php
$account = Account::where('account_number', $number)
    ->lockForUpdate()
    ->first();
```

### 2. Idempotency

Ù‡Ù…ÛŒØ´Ù‡ Ø§Ø² idempotency key Ø¨Ø±Ø§ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:
```php
$idempotencyKey = 'payment-' . $paymentId . '-' . time();
$transaction = $service->transfer(..., $idempotencyKey);
```

### 3. Error Handling

Ù‡Ù…ÛŒØ´Ù‡ Ø®Ø·Ø§Ù‡Ø§ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ handle Ú©Ù†ÛŒØ¯:
```php
try {
    $transaction = $service->transfer(...);
} catch (\RuntimeException $e) {
    if ($e->getMessage() === 'Insufficient funds') {
        // handle insufficient funds
    } else {
        // handle other errors
    }
}
```

### 4. Logging

Ø¨Ø±Ø§ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù…ØŒ Ù„Ø§Ú¯ Ú©Ù†ÛŒØ¯:
```php
use Illuminate\Support\Facades\Log;

Log::info('Transaction completed', [
    'transaction_id' => $transaction->id,
    'amount' => $transaction->amount,
]);
```

---

## Ù…Ù†Ø§Ø¨Ø¹ Ø¨ÛŒØ´ØªØ±

- [Ù…Ø³ØªÙ†Ø¯Ø§Øª API](./API_DOCUMENTATION.md)
- [README Ù…Ø§Ú˜ÙˆÙ„](./README.md)
- [Laravel Documentation](https://laravel.com/docs)

---

**Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:** 2025-11-22

