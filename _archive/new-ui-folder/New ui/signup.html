<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarthCoop - عضویت</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;800;900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom Tailwind Configuration - پیکربندی رنگ‌ها و فونت‌ها */
        :root {
            --color-earth-green: #10b981; /* سبز زمینی */
            --color-ocean-blue: #3b82f6; /* آبی اقیانوسی */
            --color-digital-gold: #f59e0b; /* طلایی دیجیتال */
            --color-pure-white: #ffffff; /* سفید خالص */
            --color-light-gray: #f8fafc; /* خاکستری روشن */
            --color-gentle-black: #1e293b; /* مشکی ملایم */
            --color-dark-green: #047857; /* سبز تیره */
            --color-dark-blue: #1d4ed8; /* آبی تیره */
            --color-accent-peach: #ff7e5f; /* هلویی تاکیدی */
            --color-accent-sky: #6dd5ed; /* آبی آسمانی تاکیدی */
            --color-purple-700: #6B46C1; /* بنفش تیره برای هاور */
            --color-vibrant-yellow: #FFD700; /* زرد پر جنب و جوش */
            --color-vibrant-pink: #FF69B4; /* صورتی پر جنب و جوش */
            --color-vibrant-orange: #FFA500; /* نارنجی پر جنب و جوش */
        }

        /* Utility classes for custom colors */
        .bg-earth-green { background-color: var(--color-earth-green); }
        .text-earth-green { color: var(--color-earth-green); }
        .bg-ocean-blue { background-color: var(--color-ocean-blue); }
        .text-ocean-blue { color: var(--color-ocean-blue); }
        .bg-digital-gold { background-color: var(--color-digital-gold); }
        .text-digital-gold { color: var(--color-digital-gold); }
        .bg-pure-white { background-color: var(--color-pure-white); }
        .text-pure-white { color: var(--color-pure-white); }
        .bg-light-gray { background-color: var(--color-light-gray); }
        .text-light-gray { color: var(--color-light-gray); }
        .bg-gentle-black { background-color: var(--color-gentle-black); }
        .text-gentle-black { color: var(--color-gentle-black); }
        .bg-dark-green { background-color: var(--color-dark-green); }
        .bg-dark-blue { background-color: var(--color-dark-blue); }
        .bg-accent-peach { background-color: var(--color-accent-peach); }
        .text-accent-peach { color: var(--color-accent-peach); }
        .bg-accent-sky { background-color: var(--color-accent-sky); }
        .text-accent-sky { color: var(--color-accent-sky); }
        .text-purple-700 { color: var(--color-purple-700); }

        /* Font Families - Vazirmatn for Farsi, Poppins for English numbers/text */
        .font-vazirmatn { font-family: 'Vazirmatn', sans-serif; }
        .font-poppins { font-family: 'Poppins', sans-serif; }

        /* Custom animation for the logo */
        @keyframes bounce-custom {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .animate-bounce-custom { animation: bounce-custom 3s infinite ease-in-out; }

        /* Gradient background for the signup card */
        .signup-card-gradient {
            background: linear-gradient(145deg, var(--color-pure-white) 0%, #f0f4f7 100%);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.08);
            transition: all 0.4s ease;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(220, 220, 220, 0.3);
        }
        .signup-card-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--color-earth-green), var(--color-ocean-blue), var(--color-digital-gold));
        }

        /* Vibrant background for the body */
        /* پس‌زمینه برای بدنه (تغییر یافته به طوسی) */
        body {
            background-color: #e2e8f0; /* رنگ طوسی روشن */
            background-attachment: fixed;
        }

        /* Google button styling */
        .google-button {
            background-color: #4285F4; /* Google Blue */
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 9999px; /* Full rounded */
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .google-button:hover {
            background-color: #357ae8; /* Darker Google Blue */
            transform: scale(1.05);
        }
        .google-button .fab {
            font-size: 1.25rem;
        }

        /* Custom modal for error messages */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="font-poppins text-gentle-black leading-relaxed flex items-center justify-center min-h-screen p-4">

    <!-- Changed max-w-md to max-w-2xl to match form.html -->
    <div class="signup-card-gradient w-full max-w-2xl mx-auto p-8 md:p-10 text-center">
        <div class="flex items-center justify-center space-x-3 rtl:space-x-reverse mb-8">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="animate-bounce-custom">
                <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z" fill="#10b981" opacity="0.8"/>
                <path d="M12 2C10.5 4 8 6 8 9C8 12 12 14 12 14C12 14 16 12 16 9C16 6 13.5 4 12 2ZM12 14C12 14 10 16 10 18C10 20 12 22 12 22" fill="#047857"/>
            </svg>
            <span class="text-4xl font-extrabold text-gentle-black font-vazirmatn">EarthCoop</span>
        </div>

        <h2 class="text-3xl md:text-4xl font-extrabold font-vazirmatn text-gentle-black mb-6">
            ایجاد حساب کاربری جدید
        </h2>
        <p class="text-gray-700 mb-8 font-vazirmatn">
            برای عضویت، لطفا اطلاعات خود را وارد کنید.
        </p>

        <form id="signup-form" action="#" method="POST" class="space-y-6 text-right">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 font-vazirmatn mb-2">
                    آدرس ایمیل
                </label>
                <input type="email" id="email" name="email" required
                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-ocean-blue focus:border-ocean-blue sm:text-sm font-poppins text-gentle-black text-right"
                       placeholder="example@email.com">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 font-vazirmatn mb-2">
                    رمز عبور
                </label>
                <div class="relative">
                    <!-- Reverted text-left to text-right and pr-10 to pl-10 for input field -->
                    <input type="password" id="password" name="password" required
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-ocean-blue focus:border-ocean-blue sm:text-sm font-poppins text-gentle-black text-right pl-10"
                           placeholder="********">
                    <!-- Changed pr-3 to pl-3 for the icon to move it slightly inside -->
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 cursor-pointer" id="togglePassword">
                        <i class="far fa-eye-slash text-gray-500"></i>
                    </span>
                </div>
            </div>
            <div>
                <label for="confirm-password" class="block text-sm font-medium text-gray-700 font-vazirmatn mb-2">
                    تکرار رمز عبور
                </label>
                <div class="relative">
                    <!-- Reverted text-left to text-right and pr-10 to pl-10 for input field -->
                    <input type="password" id="confirm-password" name="confirm-password" required
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-ocean-blue focus:border-ocean-blue sm:text-sm font-poppins text-gentle-black text-right pl-10"
                           placeholder="********">
                    <!-- Changed pr-3 to pl-3 for the icon to move it slightly inside -->
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 cursor-pointer" id="toggleConfirmPassword">
                        <i class="far fa-eye-slash text-gray-500"></i>
                    </span>
                </div>
            </div>

            <div class="flex items-center justify-start text-sm mt-4">
                <input type="checkbox" id="terms-checkbox" name="terms-checkbox" class="h-4 w-4 text-earth-green focus:ring-earth-green border-gray-300 rounded ml-2 rtl:mr-2">
                <label for="terms-checkbox" class="font-vazirmatn text-gray-700">
                    با
                    <a href="terms-and-conditions.html" class="font-medium text-ocean-blue hover:text-dark-blue transition duration-300" target="_blank">
                        اساسنامه و شرایط استفاده
                    </a>
                    موافقم.
                </label>
            </div>

            <button type="submit" id="signup-button"
                    class="w-full bg-earth-green text-pure-white px-6 py-3 rounded-full shadow-md hover:bg-dark-green transition duration-300 font-vazirmatn font-bold text-lg transform hover:scale-105">
                ادامه
            </button>
        </form>

        <div class="mt-6 flex items-center justify-center">
            <div class="border-t border-gray-300 flex-grow"></div>
            <span class="px-3 text-gray-500 font-vazirmatn text-sm">یا</span>
            <div class="border-t border-gray-300 flex-grow"></div>
        </div>

        <button id="google-signup-button" class="google-button w-full mt-6 font-vazirmatn transform hover:scale-105">
            <i class="fab fa-google"></i>
            <span>ثبت‌نام با گوگل</span>
        </button>

        <div class="mt-8 text-center text-sm font-vazirmatn">
            <p class="text-gray-700">
                حساب کاربری دارید؟
                <a href="login.html" class="font-medium text-ocean-blue hover:text-dark-blue transition duration-300">
                    ورود
                </a>
            </p>
        </div>
    </div>

    <div id="message-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modal-message" class="font-vazirmatn text-gentle-black text-lg"></p>
            <button id="modal-ok-button" class="mt-4 bg-ocean-blue text-pure-white px-6 py-2 rounded-full hover:bg-dark-blue transition duration-300 font-vazirmatn">باشه</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration - REPLACE WITH YOUR ACTUAL FIREBASE CONFIG
        // این پیکربندی Firebase شماست. مقادیر واقعی را از کنسول Firebase خود جایگزین کنید.
        // به Project settings > General > Your apps > Firebase SDK snippet > Config بروید.
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE", // <-- این را با کلید API واقعی خود جایگزین کنید
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com", // <-- این را با دامنه احراز هویت واقعی خود جایگزین کنید
            projectId: "YOUR_PROJECT_ID", // <-- این را با شناسه پروژه واقعی خود جایگزین کنید
            storageBucket: "YOUR_PROJECT_ID.appspot.com", // <-- این را با سطل ذخیره‌سازی واقعی خود جایگزین کنید
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID", // <-- این را با شناسه فرستنده پیام واقعی خود جایگزین کنید
            appId: "YOUR_APP_ID", // <-- این را با شناسه برنامه واقعی خود جایگزین کنید
            // measurementId: "YOUR_MEASUREMENT_ID" // Optional - اگر از Google Analytics استفاده می‌کنید، این خط را فعال و مقدار آن را جایگزین کنید
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Get elements for the custom modal
        const messageModal = document.getElementById('message-modal');
        const modalMessage = document.getElementById('modal-message');
        const closeButton = document.querySelector('.close-button');
        const modalOkButton = document.getElementById('modal-ok-button');

        // Function to display the custom modal
        function showModal(message) {
            modalMessage.textContent = message;
            messageModal.style.display = 'flex'; // Use flex to center the modal
        }

        // Close the modal when the close button or OK button is clicked
        closeButton.onclick = function() {
            messageModal.style.display = 'none';
        }
        modalOkButton.onclick = function() {
            messageModal.style.display = 'none';
        }

        // Close the modal when clicking outside of the modal content
        window.onclick = function(event) {
            if (event.target == messageModal) {
                messageModal.style.display = 'none';
            }
        }

        // Get password and confirm password input fields and their toggle icons
        const passwordInput = document.getElementById('password');
        const togglePassword = document.getElementById('togglePassword');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');

        // Function to toggle password visibility
        function togglePasswordVisibility(inputField, toggleIcon) {
            // Check the type of the input field
            const type = inputField.getAttribute('type') === 'password' ? 'text' : 'password';
            // Set the new type
            inputField.setAttribute('type', type);
            // Toggle the eye icon class
            toggleIcon.querySelector('i').classList.toggle('fa-eye');
            toggleIcon.querySelector('i').classList.toggle('fa-eye-slash');
        }

        // Add event listeners to toggle icons
        if (togglePassword) {
            togglePassword.addEventListener('click', () => {
                togglePasswordVisibility(passwordInput, togglePassword);
            });
        }

        if (toggleConfirmPassword) {
            toggleConfirmPassword.addEventListener('click', () => {
                togglePasswordVisibility(confirmPasswordInput, toggleConfirmPassword);
            });
        }

        // Handle Signup Form Submission
        const signupForm = document.getElementById('signup-form');
        if (signupForm) {
            signupForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent default form submission

                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                const termsCheckbox = document.getElementById('terms-checkbox');

                if (!termsCheckbox.checked) {
                    showModal("برای ادامه باید قوانین را بپذیرید.");
                    return;
                }

                // Check if passwords match
                if (password !== confirmPassword) {
                    showModal("رمز عبور و تکرار آن مطابقت ندارند.");
                    return;
                }

                try {
                    // Create user with email and password
                    await createUserWithEmailAndPassword(auth, email, password);
                    showModal("حساب کاربری با موفقیت ایجاد شد! شما وارد شدید.");
                    // Redirect to the 'form' page after successful signup
                    // Use a slight delay to allow modal to be seen, then redirect
                    setTimeout(() => {
                        window.location.href = 'form/form.html';
                    }, 1500); // Redirect after 1.5 seconds
                } catch (error) {
                    // Log the full error object to the console for detailed debugging
                    console.error("Signup Error (Detailed):", error); // <-- این خط برای عیب یابی دقیق تر است
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    let displayMessage = "خطا در ثبت نام. لطفا دوباره تلاش کنید.";
                    if (errorCode === 'auth/email-already-in-use') {
                        displayMessage = "این ایمیل قبلاً ثبت‌نام شده است.";
                    } else if (errorCode === 'auth/invalid-email') {
                        displayMessage = "فرمت ایمیل نامعتبر است.";
                    } else if (errorCode === 'auth/weak-password') {
                        displayMessage = "رمز عبور باید حداقل ۶ کاراکتر باشد.";
                    } else if (errorCode === 'auth/network-request-failed') {
                        displayMessage = "مشکل در اتصال به اینترنت. لطفا اتصال خود را بررسی کنید.";
                    }
                    showModal(`خطا: ${displayMessage}`);
                }
            });
        }

        // Google Sign-Up
        const googleSignupButton = document.getElementById('google-signup-button');
        if (googleSignupButton) {
            googleSignupButton.addEventListener('click', async () => {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                    showModal("با موفقیت با گوگل ثبت‌نام و وارد شدید!");
                    // Redirect to the 'form' page after successful Google signup
                    setTimeout(() => {
                        window.location.href = 'form/form.html';
                    }, 1500); // Redirect after 1.5 seconds
                } catch (error) {
                    // Log the full error object to the console for detailed debugging
                    console.error("Google Sign-Up Error (Detailed):", error); // <-- این خط برای عیب یابی دقیق تر است
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    let displayMessage = "خطا در ثبت نام با گوگل. لطفا دوباره تلاش کنید.";
                    if (errorCode === 'auth/popup-closed-by-user') {
                        displayMessage = "پنجره ورود با گوگل بسته شد.";
                    } else if (errorCode === 'auth/cancelled-popup-request') {
                        displayMessage = "درخواست ورود با گوگل لغو شد.";
                    } else if (errorCode === 'auth/network-request-failed') {
                        displayMessage = "مشکل در اتصال به اینترنت. لطفا اتصال خود را بررسی کنید.";
                    }
                    showModal(`خطا در ثبت‌نام با گوگل: ${displayMessage}`);
                }
            });
        }
    </script>
</body>
</html>
