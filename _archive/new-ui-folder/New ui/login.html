<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarthCoop - ورود</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Vazirmatn for Farsi, Poppins for English numbers/text -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;800;900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom Tailwind Configuration - پیکربندی رنگ‌ها و فونت‌ها */
        :root {
            --color-earth-green: #10b981; /* سبز زمینی */
            --color-ocean-blue: #3b82f6; /* آبی اقیانوسی */
            --color-digital-gold: #f59e0b; /* طلایی دیجیتال */
            --color-pure-white: #ffffff; /* سفید خالص */
            --color-light-gray: #f8fafc; /* خاکستری روشن */
            --color-gentle-black: #1e293b; /* مشکی ملایم */
            --color-dark-green: #047857; /* سبز تیره */
            --color-dark-blue: #1d4ed8; /* آبی تیره */
            --color-accent-peach: #ff7e5f; /* هلویی تاکیدی */
            --color-accent-sky: #6dd5ed; /* آبی آسمانی تاکیدی */
            --color-purple-700: #6B46C1; /* بنفش تیره برای هاور */
            --color-vibrant-yellow: #FFD700; /* زرد پر جنب و جوش */
            --color-vibrant-pink: #FF69B4; /* صورتی پر جنب و جوش */
            --color-vibrant-orange: #FFA500; /* نارنجی پر جنب و جوش */
        }

        /* Utility classes for custom colors */
        .bg-earth-green { background-color: var(--color-earth-green); }
        .text-earth-green { color: var(--color-earth-green); }
        .bg-ocean-blue { background-color: var(--color-ocean-blue); }
        .text-ocean-blue { color: var(--color-ocean-blue); }
        .bg-digital-gold { background-color: var(--color-digital-gold); }
        .text-digital-gold { color: var(--color-digital-gold); }
        .bg-pure-white { background-color: var(--color-pure-white); }
        .text-pure-white { color: var(--color-pure-white); }
        .bg-light-gray { background-color: var(--color-light-gray); }
        .text-light-gray { color: var(--color-light-gray); }
        .bg-gentle-black { background-color: var(--color-gentle-black); }
        .text-gentle-black { color: var(--color-gentle-black); }
        .bg-dark-green { background-color: var(--color-dark-green); }
        .bg-dark-blue { background-color: var(--color-dark-blue); }
        .bg-accent-peach { background-color: var(--color-accent-peach); }
        .text-accent-peach { color: var(--color-accent-peach); }
        .bg-accent-sky { background-color: var(--color-accent-sky); }
        .text-accent-sky { color: var(--color-accent-sky); }
        .text-purple-700 { color: var(--color-purple-700); }

        /* Font Families - Vazirmatn for Farsi, Poppins for English numbers/text */
        .font-vazirmatn { font-family: 'Vazirmatn', sans-serif; }
        .font-poppins { font-family: 'Poppins', sans-serif; }

        /* Custom animation for the logo */
        @keyframes bounce-custom {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .animate-bounce-custom { animation: bounce-custom 3s infinite ease-in-out; }

        /* Gradient background for the login card */
        .login-card-gradient {
            background: linear-gradient(145deg, var(--color-pure-white) 0%, #f0f4f7 100%);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.08);
            transition: all 0.4s ease;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(220, 220, 220, 0.3);
        }
        .login-card-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--color-earth-green), var(--color-ocean-blue), var(--color-digital-gold));
        }

        /* Vibrant background for the body */
        /* پس‌زمینه برای بدنه (تغییر یافته به طوسی) */
        body {
            background-color: #e2e8f0; /* رنگ طوسی روشن */
            background-attachment: fixed;
        }

        /* Google button styling */
        .google-button {
            background-color: #4285F4; /* Google Blue */
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 9999px; /* Full rounded */
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .google-button:hover {
            background-color: #357ae8; /* Darker Google Blue */
            transform: scale(1.05);
        }
        .google-button .fab {
            font-size: 1.25rem;
        }
    </style>
</head>
<body class="font-poppins text-gentle-black leading-relaxed flex items-center justify-center min-h-screen p-4">

    <!-- Changed max-w-md to max-w-2xl to match form.html -->
    <div class="login-card-gradient w-full max-w-2xl mx-auto p-8 md:p-10 text-center">
        <div class="flex items-center justify-center space-x-3 rtl:space-x-reverse mb-8">
            <!-- EarthCoop Logo (reused from main.html) -->
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="animate-bounce-custom">
                <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z" fill="#10b981" opacity="0.8"/>
                <path d="M12 2C10.5 4 8 6 8 9C8 12 12 14 12 14C12 14 16 12 16 9C16 6 13.5 4 12 2ZM12 14C12 14 10 16 10 18C10 20 12 22 12 22" fill="#047857"/>
            </svg>
            <span class="text-4xl font-extrabold text-gentle-black font-vazirmatn">EarthCoop</span>
        </div>

        <h2 class="text-3xl md:text-4xl font-extrabold font-vazirmatn text-gentle-black mb-6">
            ورود به حساب کاربری
        </h2>
        <p class="text-gray-700 mb-8 font-vazirmatn">
            برای ادامه، لطفا اطلاعات خود را وارد کنید.
        </p>

        <form action="#" method="POST" class="space-y-6 text-right">
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 font-vazirmatn mb-2">
                    ایمیل یا نام کاربری
                </label>
                <input type="text" id="email" name="email" required
                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-ocean-blue focus:border-ocean-blue sm:text-sm font-poppins text-gentle-black text-right"
                       placeholder="example@email.com">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 font-vazirmatn mb-2">
                    رمز عبور
                </label>
                <input type="password" id="password" name="password" required
                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-ocean-blue focus:border-ocean-blue sm:text-sm font-poppins text-gentle-black text-right"
                       placeholder="********">
            </div>

            <div class="flex items-center justify-between text-sm">
                <a href="#" class="font-medium text-ocean-blue hover:text-dark-blue font-vazirmatn transition duration-300">
                    رمز عبور خود را فراموش کرده‌اید؟
                </a>
            </div>

            <button type="submit"
                    class="w-full bg-earth-green text-pure-white px-6 py-3 rounded-full shadow-md hover:bg-dark-green transition duration-300 font-vazirmatn font-bold text-lg transform hover:scale-105">
                ورود
            </button>
        </form>

        <div class="mt-6 flex items-center justify-center">
            <div class="border-t border-gray-300 flex-grow"></div>
            <span class="px-3 text-gray-500 font-vazirmatn text-sm">یا</span>
            <div class="border-t border-gray-300 flex-grow"></div>
        </div>

        <!-- Google Login Button -->
        <button id="google-login-button" class="google-button w-full mt-6 font-vazirmatn transform hover:scale-105">
            <i class="fab fa-google"></i>
            <span>ورود با گوگل</span>
        </button>

        <div class="mt-8 text-center text-sm font-vazirmatn">
            <p class="text-gray-700">
                حساب کاربری ندارید؟
                <a href="signup.html" class="font-medium text-ocean-blue hover:text-dark-blue transition duration-300">
                    ثبت‌نام کنید
                </a>
            </p>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration (replace with your actual config)
        // این پیکربندی Firebase شماست. مقادیر واقعی را جایگزین کنید.
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        // Initialize Firebase
        // Firebase را مقداردهی اولیه کنید
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app); // Firestore را مقداردهی اولیه کنید

        // Sign in with custom token or anonymously
        // با توکن سفارشی یا به صورت ناشناس وارد شوید
        async function authenticateUser() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                    console.log("Signed in with custom token.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Signed in anonymously.");
                }
                const userId = auth.currentUser?.uid || crypto.randomUUID();
                console.log("User ID:", userId);
            } catch (error) {
                console.error("Firebase authentication error:", error);
            }
        }

        authenticateUser();

        // Google Sign-In
        // ورود با گوگل
        const googleLoginButton = document.getElementById('google-login-button');
        if (googleLoginButton) {
            googleLoginButton.addEventListener('click', async () => {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                    // User signed in successfully with Google.
                    // کاربر با موفقیت با گوگل وارد شد.
                    console.log("User signed in with Google!");
                    // You can redirect the user or update the UI here.
                    // می‌توانید کاربر را به صفحه دیگری هدایت کنید یا UI را به‌روزرسانی کنید.
                    // Example: window.location.href = 'dashboard.html';
                } catch (error) {
                    // Handle Errors here.
                    // خطاها را اینجا مدیریت کنید.
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    const email = error.customData?.email;
                    const credential = GoogleAuthProvider.credentialFromError(error);
                    console.error("Google Sign-In Error:", errorCode, errorMessage, email, credential);
                    // Display an error message to the user (e.g., using a custom modal)
                    // یک پیام خطا به کاربر نمایش دهید (مثلاً با استفاده از یک مودال سفارشی)
                    // alert(`خطا در ورود با گوگل: ${errorMessage}`); // Using alert for simplicity, replace with custom modal
                    // استفاده از یک مودال سفارشی به جای alert
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center';
                    modal.innerHTML = `
                        <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                            <h3 class="text-lg font-bold mb-4">خطا در ورود</h3>
                            <p class="text-gray-700 mb-6">${errorMessage}</p>
                            <button id="close-modal" class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600">بستن</button>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    document.getElementById('close-modal').addEventListener('click', () => {
                        document.body.removeChild(modal);
                    });
                }
            });
        }
    </script>
</body>
</html>
